cromfs - Copyright (C) 1992,2006 Bisqwit (http://iki.fi/bisqwit/)
Licence: GPL
Homepage: http://bisqwit.iki.fi/source/cromfs.html

cromfs filesystem structure / format description.

--------------------------------
Note: Inode 1 is assumed to be the root directory by the kernel.

Note: All integers are encoded in little-endian byte order.

OVERALL STRUCTURE

OBJECT: SUPERBLOCK
	0000	u64	CROMFS SIGNATURE "CROMFS01"
	0008	u64	Location of BLKDATA within the filesystem
	0010	u64	Location of FBLKTAB within the filesystem
	0018	u64	Location of the Inotab inode within the filesystem
	0020	u64	Location of the Root directory within the filesystem
	0028	u32	FSIZE Size of compressed data in fblocks (default: 1M)
	002C	u32	BSIZE Size of uncompressed blocks (default: 64k)
	0030	u64	Bytes of file data on disk
	0...	INODE	Root directory
	0...	INODE	Inotab (only the "list of blocks" is used)
	0...	BLKDATA	LZMA-compressed array of BLOCK entries.
	0...	FBLOCK[] FBLKTAB = compressed storage

---------------------------

STRUCT: FBLOCK
	0000	u32	length of compressed data
	0004	char[]	(FSIZE-4) bytes of LZMA-compressed data
	0009	u64	length of uncompressed data (located within LZMA-compressed data)

STRUCT: BLKDATA (LZMA-compressed)
	0000	BLOCK[]  BLKTAB = all blocks of the filesystem (indexed by block number)
	(Note: To handle BLKDATA effeciently, it must be decompressed entirely
	into the RAM when the block lists are needed. This typically might consume
	several megabytes of RAM. However, cromfs-driver deallocates the
	data periodically when the filesystem has been idle for some time.)

STRUCT: BLOCK
	0000	u32	FBLOCK number (0=first block, 1=second block, etc)
	0004	u32	starting offset within the _uncompressed data_ for this BSIZE of data

STRUCT: INODE
	0000	u32	mode
	0004	u32	mtime
	0008	u32	links (hardlink count)
	000C	u32	rdev, if a device
	0010	u64	size in bytes
	0018	u32[]	list of blocks

STRUCT: ENTRY
	0000	u64	inode number
	0008	char[]	file name, nul-terminated

ALL FILES ARE COMPRESSED (the content is spread across different FBLOCKs)

FILE CONTENT WHEN: INOTAB
	0000	INODE[] all inodes of the filesystem
	                the beginning of each inode is at offset ((inodenumber-2) * 4)
	                inodenumber 1 is the root directory (not stored in INOTAB),
	                and inodenumber 0 is error.

FILE CONTENT WHEN: DIRECTORY
	0000	u32	number of files in directory
	0004	u32[]	index into each file entry (from directory entry beginning)
	0004	ENTRY[]	each file entry (variable length)

FILE CONTENT WHEN: SYMLINK
	0000	char[]	link text, not nul-terminated

FILE CONTENT WHEN: REGULAR FILES
	0000	content	file content
