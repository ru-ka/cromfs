Cromfs changelog

cromfs - Copyright (C) 1992,2007 Bisqwit (http://iki.fi/bisqwit/)
License: GPL3
Homepage: http://bisqwit.iki.fi/source/cromfs.html

1.5.1	2007-08-13 Joel Yliluoma <bisqwit@iki.fi>
- mkfromfs: The memory efficiency of the block index was further
  improved, enabling the use of a slightly shorter autoindex period
  if one so chooses.
- mkcromfs, unmkcromfs: Improved threading performance by introducing 
  a concept of permanent worker threads, instead of threads deleted
  and recreated at every request.
- mkcromfs: Added --overlapgranularity (-g) option. It is experimental,
  and in theory improves reuse rate on periodical data. It restricts
  partial overlap into numbers that are evenly divisible with the given
  value.

1.5.0	2007-07-29 Joel Yliluoma <bisqwit@iki.fi>
- License change: Now it is under GPL3. (Previously GPL2.)
- mkcromfs: Changed the order in which inode numbers are assigned,
  improving the access times, reducing directory fragmentation
  and making the recently added --dirparseorder a more useful
  option. It seems to also improve compression.
- Internal changes: In an effort to improve portability of the
  code, moved most of the file access code into include files
  that handle sparseness, memory mapping and regular file
  reading/writing in one place.
- mkcromfs: In attempt to improve the block scheduler, a
  new --blockifyoptimizemethod value was introduced. It uses
  a variation of the Asymmetric Travelling Salesman Problem
  to determine an optimal order for blockifying. It may or may not
  improve compression, but it does consume a lot more CPU time.
- mkcromfs: The memory efficiency of the block index was improved,
  enabling the use of slightly larger autoindex ratio if one so chooses.
  (Note: The actual effect of the change is yet untested.)
- mkcromfs: Fixed a bug in autoindex: Index hits did not assign
  a block number to the index. Compression power improved again.
- General: Using posix_fadvice() to hint the kernel about proper
  page cache strategy. Theoretically should improve performance.
- Experimented with asynchronous IO (AIO) in unmkcromfs. However,
  it seemed to not do much good, so it is now disabled by default,
  enableable only by a #define.
- cromfs-driver: Changed the cache so that now oldest accessed
  flocks are deallocated first, instead of randomly choosing one.
  Same for directory listings. Should improve performance.
- mkcromfs: Added threading to improve performance on multicore systems.
  (New option: --threads).
- unmkcromfs: Added threading to improve performance on multicore systems.
  (New option: --threads).
- mkcromfs: Raised the default value of --bruteforcelimit to 2,
  from the previous value of 1. (0 and 1 are equal.)
- Added -ldl in Makefile to enable linking with fuse 2.7.
- mkcromfs: Replaced --autoindexratio (-a) with --autoindexperiod (-A)
  that has inverse, but cleaner, semantics. The old option will still
  work, but is now deprecated.
- mkcromfs: Improved autoindexer performance.
- unmkcromfs: Fixed an error that prevented hardlinked files
  from being extracted properly in some cases.
- Documentation updates (some new compression tests & comparisons)

1.4.1	2007-07-15 Joel Yliluoma <bisqwit@iki.fi>
- Added autochoosing heuristics for the -3 (--24bitblocknums),
  -2 (--16bitblocknums) and -k (--packedblocks) options, because
  it can improve compression and those who profile mkcromfs,
  will do so with its default options :)
- Added --32bitblocknums (-4) for overriding the autochoosing heuristics.
- Replaced the -k (--packedblocks) option with --nopackedblocks
  for overriding the heuristics.
- Fixed a bug that caused almost-empty fblocks to be created needlessly.
- Fixed a bug that prevented --lzmabits from being parsed properly.
- Reorganized source code directories, resulting in a larger diff than normally.
- Experimentally added BWT and MTF filters. Both seem to do more harm than
  good, so they're disabled by default. Apparently LZMA benefits from neither.
- Fixed a severe bug introduced in 1.4.0 that prevented older filesystems from
  being mounted properly.

1.4.0	2007-07-13 Joel Yliluoma <bisqwit@iki.fi>
- Removed filename length limit
- Rewrote most of mkcromfs. A new algorithm of organizing the blocks of
  files before locating them in fblocks ("blockifying") should improve
  compression. This does not change the actual format of the filesystem.
- Added several blockify-related optimization options in mkcromfs.
  (--blockifybufferlength, --blockifybufferincrement,
  and --blockifyoptimizemethod).
- Speed improvements in cromfs-driver:
  - Optimized read_file_data() and read_dir() in case of heavily fragmented
    filesystems. It will, however, incur a slight performance penalty for
    non-fragmented filesystems.
  - Added an implementation of dir_lookup(), significantly improving the
    performance of lookups especially on heavily fragmented filesystems.
- Added -3 (--24bitblocknums), -2 (--16bitblocknums) and -k (--packedblocks)
  options in mkcromfs (extension to cromfs file format).
  Each of these options have some potential for improving the compression.
  Even if LZMA negates it, at least it reduces memory traffic during
  cromfs-driver operation, so it is recommended to use those where possible.
- Fixed a few endianess problems.
- Added --lzmafastbytes option in mkcromfs and cvcromfs, making the number of
  LZMA "fast bytes" configurable. Also raised the default from 64 to 273 (maximum).
  Larger number usually results in a better compression.
- Added --lzmabits option in mkcromfs and cvcromfs for LZMA compression finetuning.
- Added possibility to alter the order in which different types of files
  are compressed. (Options --blockifyorder and --dirparseorder in mkcromfs.)
- Upgraded LZMA SDK from version 4.43 to 4.49 beta.

1.3.0	2007-06-30 Joel Yliluoma <bisqwit@iki.fi>
- New format is under work (filesystem write-mounting)
- cromfs-driver now goes background (fork) by default (use -f to go foreground)
- Added -v (--verbose) in unmkcromfs (and tuned down verbosiness by default)
- Documented how to use autofs with cromfs (thanks Petr Pudlak)

1.2.5	2007-02-14 Joel Yliluoma <bisqwit@iki.fi>
- Tentatively fixed endianess problems (needs testing!)
- Updated box art
- Fixed a readdir problem that caused GNU find to not work properly
  (because it relied on undocumented d_type field in readdir results).
- Only cromfs-driver is affected; filesystems do not need to be reconstructed.

1.2.4.5	2007-02-12 Joel Yliluoma <bisqwit@iki.fi>
- Documentation updates

1.2.4.4	2007-01-27 Joel Yliluoma <bisqwit@iki.fi>
- Fixed yet another compilation problem, by reverting to fuse 2.5 API
- Documentation updates

1.2.4.3	2007-01-26 Joel Yliluoma <bisqwit@iki.fi>
- Fixed another compilation problem

1.2.4.2	2007-01-11 Joel Yliluoma <bisqwit@iki.fi>
- Fixed a compilation problem in unmkcromfs

1.2.4.1	2006-12-05 Joel Yliluoma <bisqwit@iki.fi>
- Added -l (--followsymlinks) in mkcromfs
- Made --simgraph in unmkcromfs a lot faster

1.2.4	2006-12-04 Joel Yliluoma <bisqwit@iki.fi>
- Added --simgraph in unmkcromfs

1.2.3	2006-08-31 Joel Yliluoma <bisqwit@iki.fi>
- Added -x and -X (--exclude and --exclude-from) in mkcromfs
  and unmkcromfs (thanks to Jeff Strunk for suggesting this)

1.2.2	2006-08-23 Joel Yliluoma <bisqwit@iki.fi>
- Added a static cromfs-driver (cromfs-driver-static) for bootdisks

1.2.1	2006-08-09 Joel Yliluoma <bisqwit@iki.fi>
- Added -q, -qq, -qqq in mkcromfs
  (thanks to Gilson Laurent for suggesting this)
- Fixed the weird permissions of mountpoints
- Disabled GCC option -ftree-vectorize by default,
  because GCC-4 is not widespread enough yet.
- Large file support fixed in unmkcromfs
- Fixed the stat()/lstat() calls; they previously reported
  blkcounts 8 times to small, causing "du" to report wrong sizes.

1.2.0	2006-06-06 Joel Yliluoma <bisqwit@iki.fi>
- New filesystem format (old filesystems are still supported)
  The inode table inode and root directory inode are now compressed.
- New utility: cvcromfs (to convert filesystems between versions 01 and 02)
  (also helpful if new and more effecient versions of LZMA are released,
   to recompress existing filesystems)

1.1.7	2006-06-05 Joel Yliluoma <bisqwit@iki.fi>
- Hardlink extraction support in unmkcromfs
- Added tests: make test

1.1.6.1	2006-06-04 Joel Yliluoma <bisqwit@iki.fi>
- Compilation workaround
- More options in unmkcromfs

1.1.6	2006-06-04 Joel Yliluoma <bisqwit@iki.fi>
- Added a new utility: unmkcromfs
  It extracts the contents of a cromfs volume without mounting it
  using an optimized algorithm that minimizes duplicate data access.

1.1.5	2006-06-03 Joel Yliluoma <bisqwit@iki.fi>
- Made the --bruteforcelimit option (-c) more useful
  in mkcromfs (performance tuning).

1.1.4.3	2006-06-01 Joel Yliluoma <bisqwit@iki.fi>
- Minor tuning in mkcromfs
- Nice image of a box to the program homepage. :)

1.1.4.2	2006-05-22 Joel Yliluoma <bisqwit@iki.fi>
- Documentation updates

1.1.4.1	2006-05-22 Joel Yliluoma <bisqwit@iki.fi>
- mkcromfs speed optimization: Bayer-Moore search algorithm
  (Noticeably faster than the Horspool version)
- Fixed mkcromfs
  - mkcromfs from 1.1.4 crashed in certain situations
  - mkcromfs 1.1.4 failed to create a filesystem
    (a debugging option was accidentally left activated)

1.1.4	2006-05-21  Joel Yliluoma <bisqwit@iki.fi>
- mkcromfs speed optimization: Bayer-Moore-Horspool search algorithm
- Documentation updates

1.1.3.1	2006-05-18 Joel Yliluoma <bisqwit@iki.fi>
- Documentation updates
- Rewrite of cromfs::read_fblock to utilize mmap64

1.1.3	2006-05-17 Joel Yliluoma <bisqwit@iki.fi>
- Changing some occassions of std::map and std::multimap
  into gnu hash_map in mkcromfs. This might enable some
  extra speed. (Though the bottleneck is in the disk access.)
- mmap-based optimizations in mkcromfs (this time
  implemented in a way that shouldn't make reiser4fs crash.)
- Possibly a crash bug fix in mkcromfs

1.1.2.3	2006-05-16 Joel Yliluoma <bisqwit@iki.fi>
- Upgraded LZMA SDK to version 4.42.
  (Ps: Someone _really_ should rewrite the LZMA compressor
  using _SANE_ C++. The official version is just horrible.
  It goes to very extremes to hack&introduce concepts which are foreign
  to C++, such as GUID, variants and C# style interfaces, and it reinvents
  many standard concepts such as integer types, smart pointers and streams,
  and as such, the code is very unmaintainable and likely suboptimal too.
  On the other hand, the C# version seems quite tidy...
  I wonder if it's the authoritative implementation? (hint: port it)
  I can only have nightmares trying to get into the mindscape
  of the programmer who wrote that horrible C++ code version.)
- Documentation updates

1.1.2.2	2006-05-15 Joel Yliluoma <bisqwit@iki.fi>
- Tuned the --bruteforcelimit function
- Documentation updates

1.1.2.1	2006-05-15 Joel Yliluoma <bisqwit@iki.fi>
- Fixed --bruteforcelimit. It didn't work in 1.1.2.
- Documentation updates

1.1.2	2006-05-15 Joel Yliluoma <bisqwit@iki.fi>
- Ownerships are now saved too (in a mostly backward+forward compatible way).
- Added new option in mkcromfs, --bruteforcelimit.

1.1.1	2006-05-14 Joel Yliluoma <bisqwit@iki.fi>
- Data integrity problem hopefully fixed now.
- Improved the usefulness of the caching in read_dir.

1.1.0.2	2006-05-14 Joel Yliluoma <bisqwit@iki.fi>
- Workaround for some noticed data integrity problem
  (some compressed blocks were assumed as uncompressed,
   and compressed over again)

1.1.0.1	2006-05-14 Joel Yliluoma <bisqwit@iki.fi>
- A compilation fix (thanks to Cu Van Chuoi)

1.1.0	2006-05-14 Joel Yliluoma <bisqwit@iki.fi>
- Removed OpenSSL dependency
- Replaced MD5 with CRC32 for smaller memory usage in mkcromfs
  (This has no effect in data integrity; a hash is just a hash.)
- Worked around an instability problem when used together with reiserfs4
  (mmapping a sparse file as read-write with copy-on-write mapping,
   and changing that underlying file, seems to under some circumstances
   cause kernel crash and kernel BUGs when the underlying filesystem is
   reiser4.)
- Disabled the auto deallocator hack for now; it hasn't worked properly.
- Changed FSIZE semantics: fsize now denotes the maximum uncompressed
 fblock size, not the maximum compressed fblock size. This made mkcromfs
 somewhat easier in design, and probably more useful for the users too.
- Removed mkcromfs option: --tryhard
- Added mkcromfs option: --autoindexratio
- Documentation updates

1.0.6	2006-05-12 Joel Yliluoma <bisqwit@iki.fi>
- Another compilation fix
- Documentation updates
- mkcromfs's temporary directory now configurable
 (recognizes the environment variable TEMP or TMP)
- mkcromfs optimization: Uses mmapping to compare portions of files.
 Most effective when used together with --decompresslookups.

1.0.5.1	2006-05-12 Joel Yliluoma <bisqwit@iki.fi>
- A compilation fix

1.0.5	2006-05-11 Joel Yliluoma <bisqwit@iki.fi>
- Added compatibility for older versions of Fuse
 (2.5.2 now supported, previously only compiled on 2.6.0)
- Changed filesystem format: FBLOCKs are now stored without padding.
 This will result in better compression, and opens opportunities
 to make mkcromfs faster.
- Added commandline option in mkcromfs:
 --tryhard

1.0.4	2006-05-11 Joel Yliluoma <bisqwit@iki.fi>
- Documentation updates
- Fixed mkcromfs error from 1.0.3 version
- Added commandline options in mkcromfs:
 --decompresslookups, --randomcompressperiod and --minfreespace

1.0.3  	2006-05-11 Joel Yliluoma <bisqwit@iki.fi>
- Documentation updates
- Broken mkcromfs release
- Added statistics reporting in mkcromfs at end

1.0.2 Joel Yliluoma <bisqwit@iki.fi>
- Added support for block devices and character devices
- Documentation updates
- Added commandline options in mkcromfs: --bsize, --fsize
- Fixed exception handling in cromfs-driver
- Changed cromfs-driver so that uid/gid now refer to the one
 who mounted the filesystem, not root
- Disabled the tracing output in cromfs-driver by default
- Changed attribute cache timeout to ~infinite
- Added periodical deallocation of BLKTAB
- Added cache of read_dir() when it's used by lookup()
- Misc tuning in mkcromfs
- mkcromfs now can stand running multiple instances at same time
- Changed the LZMA dictionary size selection method (heavier settings now)

1.0.1 Joel Yliluoma <bisqwit@iki.fi>
- Changed the LZMA implementation slightly more straight-forward
- Changed filesystem format: BLKTAB is now compressed within BLKDATA
- A slight speed optimization (later to become the "decompresslookups" option)

1.0.0 Joel Yliluoma <bisqwit@iki.fi>
- Initial release