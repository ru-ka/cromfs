<html><head><meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
 <title>Cromfs: Compressed ROM filesystem for Linux (user-space)</title>
 <style type="text/css"><!--
TABLE.toc {border:0px}
A:link,A:visited{text-decoration:none;color:#2A3B83}
A:hover{text-decoration:underline;color:#002040}
A:active{text-decoration:underline;color:#004060;background:#CCD8FF}
TD.toc   {font-size:80%; font-family:Tahoma; text-align:left}
H1       {font-size:250%; font-weight:bold} .level1 {text-align:center}
H2       {font-size:200%; font-weight:bold} .level2 {margin-left:1%}
H3       {font-size:160%; font-weight:bold} .level3 {margin-left:2%}
H4       {font-size:145%; font-weight:bold} .level4 {margin-left:3%}
H5       {font-size:130%; font-weight:bold} .level5 {margin-left:4%}
H6       {font-size:110%; font-weight:bold} .level5 {margin-left:5%}
BODY{background:white;color:black}
CODE{font-family:lucida console,courier new,courier;color:#105000}
PRE.smallerpre{font-family:lucida console,courier new,courier;font-size:80%;color:#500010;margin-left:30px}
SMALL    {font-size:70%}
.nonmail { visibility:hidden;position:absolute; top:0px;left:0px }
.ismail  { font-weight:normal }
--></style></head>
 <body>
  <h1>Cromfs: Compressed ROM filesystem for Linux (user-space)</h1>
  <h2 class=level2> 0. Contents </h2>
  
  This is the documentation of cromfs-1.0.5.1.
<div class=toc><table cellspacing=0 cellpadding=0 class=toc><tr><td width="50%" valign=middle align=left nowrap class=toc>&nbsp;&nbsp;&nbsp;1. <a href="#h0">Purpose</a><br>&nbsp;&nbsp;&nbsp;2. <a href="#overview">Overview</a><br>&nbsp;&nbsp;&nbsp;3. <a href="#limits">Limitations</a><br>&nbsp;&nbsp;&nbsp;4. <a href="#compare">Comparing to other filesystems</a><br></td>
<td width="50%" valign=middle align=left nowrap class=toc>&nbsp;&nbsp;&nbsp;5. <a href="#usage">Getting started</a><br>&nbsp;&nbsp;&nbsp;6. <a href="#tips">Tips</a><br>&nbsp;&nbsp;&nbsp;7. <a href="#copying">Copying</a><br>&nbsp;&nbsp;&nbsp;8. <a href="#requ">Requirements</a><br>&nbsp;&nbsp;&nbsp;9. <a href="#download">Downloading</a><br></td>
</tr></table></div><H2 id="h0" class="level2"><a name="h0"></a>1. Purpose</H2><div class="level2" id="divh0">

Cromfs is a compressed read-only filesystem for Linux. Cromfs is intended
for permanently archiving gigabytes of big files that have lots of redundancy.
 <p/>
In terms of compression it is much similar to
<a href="http://www.7-zip.com/">7-zip</a> files, except that practical
realtime access (albeit much slower than on most other filesystems) can be
provided for the whole archive contents; the user does not need to launch
a program to decompress a single file, nor does he need to wait while the
system decompresses 500 files from a 1000-file archive to get him the 1 file
he wanted to open.
 <p/>
The creation of cromfs was inspired
from <a href="http://squashfs.sourceforge.net/">Squashfs</a>
and <a href="http://sourceforge.net/projects/cramfs/">Cramfs</a>.

</div><H2 id="overview" class="level2"><a name="overview"></a>2. Overview</H2><div class="level2" id="divoverview">

<ul>
 <li>Data, inodes, directories and block lists are stored compressed</li>
 <li>Duplicate inodes, files and even duplicate file portions are detected and stored only once
   <ul>
    <li>Especially suitable for gigabyte-class archives of
     thousands of nearly-identical megabyte-class files.</li>
   </ul>
  </li>
 <li>Files are stored in solid blocks, meaning that parts of different
  files are compressed together for effective compression</li>
 <li>Most of inode types recognized by Linux are supported (see <a href="#compare">comparisons</a>).</li>
 <li>The <a href="http://www.7-zip.com/sdk.html">LZMA compression</a> is used.
  In the general case, LZMA compresses better than gzip and bzip2.</li>
 <li>As with usual filesystems, the files on a cromfs volume can be accessed
  in arbitrary order; the waits to open a specific file are small, despite
  the files being semisolidly archived.</li>
</ul>

See <a href="http://bisqwit.iki.fi/src/cromfs-format.txt"
>the documentation of the cromfs format</a> for technical details
(also included in the source package as doc/FORMAT).

</div><H2 id="limits" class="level2"><a name="limits"></a>3. Limitations</H2><div class="level2" id="divlimits">

<ul>
 <li>Filesystem is write-once, read-only. It is not possible to append
  to a previously-created filesystem, nor it is to mount it read-write.</li>
 <li>Max filesize: 2^64 bytes (16777216 TB), but 256 TB with default settings.</li>
 <li>Max number of files in a directory: 2^30 (smaller if filenames are longer, but still more than 100000 in almost all cases)</li>
 <li>Max number of inodes (all files, dirs etc combined): 2^60, but depends on file sizes</li>
 <li>Max filesystem size: 2^64 bytes (16777216 TB)</li>
 <li>There are no "." and ".." entries in directories.</li>
 <li>mkcromfs is slow. You must be patient.</li>
 <li>The cromfs-driver has a large memory footprint. It is not
   suitable for very size-constrained systems.</li>
 <li>Ownerships are not saved.</li>
 <li>Maximum filename length: 4095 bytes</li>
</ul>

Development status: Pre-beta. The Cromfs project has been created
very recently and it hasn't been yet tested extensively. There is no
warranty against data loss or anything else, so use at your own risk.

</div><H2 id="compare" class="level2"><a name="compare"></a>4. Comparing to other filesystems</H2><div class="level2" id="divcompare">

This is all very biased, hypothetical, and by no means
a scientific study, but here goes:

<table border=1 class=fscom>
 <tr align=left>
  <th>Feature</th>
   <th>Cromfs</th>
   <th>Cramfs</th>
   <th>Squashfs (3.0)</th>
  </tr>
 <tr align=left>
  <th>Compression unit</th>
   <td>adjustable (1 MB default)</td>
   <td>4 kB</td>
   <td>adjustable (64 kB max)</td>
  </tr>
 <tr align=left>
  <th>Files are compressed</th>
   <td>together (up to block limit)</td>
   <td>individually</td>
   <td>individually</td>
  </tr>
 <tr align=left>
  <th>Maximum file size</th>
   <td>16 EB (2^44 MB)</td>
   <td>16 MB (2^4 MB)</td>
   <td>16 EB (2^44 MB)</td>
  </tr>
 <tr align=left>
  <th>Duplicate whole file detection</th>
   <td>Yes</td>
   <td>No (but hardlinks are detected)</td>
   <td>Yes</td>
  </tr>
 <tr align=left>
  <th>Near-identical file detection</th>
   <td>Yes (identical blocks)</td>
   <td>No</td>
   <td>No</td>
  </tr>
 <tr align=left>
  <th>Compression method</th>
   <td>LZMA</td>
   <td>gzip</td>
   <td>gzip</td>
  </tr>
 <tr align=left>
  <th>Ownerships</th>
   <td>None (uses the mounter's uid and gid)</td>
   <td>uid,gid (but gid truncated to 8 bits)</td>
   <td>uid,gid</td>
 <tr align=left>
  <th>Timestamps</th>
   <td>mtime only</td>
   <td>None</td>
   <td>mtime only</td>
 <tr align=left>
  <th>Endianess-safety</th>
   <td>Works on little-endian only</td>
   <td>Safe, but not exchangeable</td>
   <td>Safe</td>
 <tr align=left>
  <th>Kernelspace/userspace</th>
   <td>User (fuse)</td>
   <td>Kernel</td>
   <td>Kernel</td>
 <tr align=left>
  <th>Appending to a previously created filesystem</th>
   <td>No</td>
   <td>No</td>
   <td>Yes</td>
 <tr align=left>
  <th>Supported inode types</th>
   <td>reg,dir,chrdev,blkdev,fifo,link,sock</td>
   <td>reg,dir,chrdev,blkdev,fifo,link,sock</td>
   <td>reg,dir,chrdev,blkdev,fifo,link,sock</td>
</table>

</div><H2 id="usage" class="level2"><a name="usage"></a>5. Getting started</H2><div class="level2" id="divusage">

<ol>
 <li>Install the development requirements: make, gcc-c++, fuse and openssl-dev
  <ul>
   <li>Remember that for fuse to work, the kernel must also contain the fuse support.
    Do "modprobe fuse", and check if you have "/dev/fuse" and check if it works.
    <ul><li>If an attempt to read from "/dev/fuse" (as root) gives "no such device",
    it does not work. If it gives "operation not permitted", it might work.</li></ul></li>
  </ul></li>
 <li>Build "cromfs-driver" and "util/mkcromfs", i.e. command "make":
  <pre>$ make</pre>
   </li>
 <li>Create a sample filesystem:
  <pre>$ util/mkcromfs . sample.cromfs</pre>
   </li>
 <li>Mount the sample filesystem:
  <pre>$ mkdir sample
$ ./cromfs-driver sample.cromfs sample &</pre>
   </li>
 <li>Observe the sample filesystem:
  <pre>$ cd sample
$ ls -al</pre>
   </li>
 <li>Unmounting the filesystem:
  <pre>$ cd ..
$ fusermount -u sample</pre>
    or, type "fg" and press ctrl-c to terminate the driver.
   </li>
</ol>

</div><H2 id="tips" class="level2"><a name="tips"></a>6. Tips</H2><div class="level2" id="divtips">

To improve the compression, try these tips:
<ul>
 <li>Adjust the block size (--bsize) in mkcromfs. If your files
     have a lot identical content, aligned at a certain boundary,
     use that boundary as the block size value.<br />
     Note: The value does not need to be a power of two.
  </li>
 <li>Adjust the fblock size (--fsize) in mkcromfs. Larger values
     cause almost always better compression. However, the filesystem
     must decompress each fblock as a single unit into the RAM.
     Larger fblock sizes increase the RAM usage of the filesystem.<br />
     Conversely, you can decrease the fblock size in order to save RAM.</li>
 <li>Sort your files. Sometimes the order in which the files
     are compressed has effect on the compressibility.</li>
</ul>

</div><H2 id="copying" class="level2"><a name="copying"></a>7. Copying</H2><div class="level2" id="divcopying">

cromfs has been written by Joel Yliluoma, a.k.a.
<a href="http://iki.fi/bisqwit/">Bisqwit</a>,<br>
and is distributed under the terms of the
<a href="http://www.gnu.org/licenses/licenses.html#GPL">General Public License</a> (GPL).
 <br/>
The LZMA code embedded within is licensed under LGPL.
 <p/>
Patches and other related material can be submitted
by e-mail at:<span id=eml23><b id=eml9 class=nonmail>inzvfue</b><span id=eml10 class=ismail>Joel</span><span id=eml11 class=nonmail><b>@mre7@uz9</b></span><span id=eml12 class=ismail> Yli</span><b id=eml13 class=nonmail>okl</b><span id=eml14 class=ismail>luom</span><span id=eml15 class=nonmail><b>2i2kaee@jq</b></span><span id=eml16 class=ismail>a &lt;bi</span><b id=eml17 class=nonmail>t7</b><span id=eml18 class=ismail>sqwi</span><span id=eml19 class=nonmail><b>ghv.kga@z</b></span><span id=eml20 class=ismail>t@ik</span><b id=eml21 class=nonmail>GY</b><span id=eml22 class=ismail>i.fi&gt;</span></span><script type="text/javascript"><!--
s='';for(i=9;i<23;){document.getElementById('eml'+i++).innerHTML='';s+=document.getElementById('eml'+i++).innerHTML;}document.getElementById('eml'+i).innerHTML='<'+'a href="mailto:'+s+'">'+s+'<'+'/a>';
--></script>

</div><H2 id="requ" class="level2"><a name="requ"></a>8. Requirements</H2><div class="level2" id="divrequ">

<ul>
 <li>GNU make and gcc-c++ are required to recompile the source code.</li>
 <li>The openssl development library is required for MD5 calculation.</li>
 <li>The filesystem works under the <a href="http://fuse.sourceforge.net/">Fuse</a>
  user-space filesystem framework. You need to install both the Fuse kernel
  module and the userspace programs before mounting Cromfs volumes.<br />
  You need version fuse version 2.6.0 or newer. (2.5.2 <i>might</i> work.)</li>
</ul>

</div><H2 id="download" class="level2"><a name="download"></a>9. Downloading</H2><div class="level2" id="divdownload">
   The official home page of cromfs
   is at <a href="http://iki.fi/bisqwit/source/cromfs.html">http://iki.fi/bisqwit/source/cromfs.html</a>.<br>
   Check there for new versions.
</div> <p align=right><small>Generated from
       <tt>progdesc.php</tt> (last updated: Fri, 12 May 2006 00:34:01 +0300)<br>
  with <tt>docmaker.php</tt> (last updated: Sun, 12 Jun 2005 06:08:02 +0300)<br>
  at Fri, 12 May 2006 12:48:52 +0300</small>
 </p>
</body>
</html>
